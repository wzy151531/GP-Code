let math = require('math');

let w = [0.0035419188909028144, -0.006423132150839993, -0.04656147162130549, -0.06339609462836614, -0.07565521103185298, -0.010533086471002234, 0.0008628419839794425, 0.012241452350661902, 0.012878500405242656, -0.004365307582715335, 0.007876610136346537, -0.02467107111532138, 0.048664680212235197, -0.0017583277084385097, -0.04551344693628907, -0.02597505723061848, -0.028819324217127282, 0.00189632682776513, -0.018804352583310115, -0.014655071949826149, -0.02736729428910464, 0.002983767256503745, 0.03827433522906397, 0.028513612321636767, -0.013547342481156606, -0.006030503766887411, 0.01410601400721615, 0.02843251304590971, 0.032101461919132476, 0.01019873250623636, 0.055914103105994865, 0.07481437687144786, 0.02497291699896543, 0.020270728653075498, 0.05435237884553163, 0.10170254382420599, 0.0677646785790777, 0.01981772804892272, 0.03349737752828571, 0.03882891965209931, 0.01333460657920736, 0.03302226008494466, 0.05008821018126869, 0.06520772632141082, 0.052982012301186744, 0.015099095406209389, 0.00862866682289009, 0.01915640470298625, 0.028357443444019383, 0.01182193135054543, 0.026979972304937767, 0.035538045515285825, 0.019886294787578803, 0.0011470855682051515, -0.014393915613218771, 0.01202955320392572, 0.011981412966215629, -0.03278029515429902, -0.00649171116456963, 0.009253363403372744, 0.01780373066779787, 0.0024911618972998056, 0.009550052553259025, 0.010347076195032648, 0.013317610811194864, -0.009590191545226414, 0.001369455450951726, 0.005489573111043446, 0.007894380263852849, 0.0023973927563205556, 0.009521522751732358, 0.007236941505901499, 0.015476890637559217, 0.0011283671796675312, 0.004766319663672568, 0.007168450317887871, 0.0010825326947579738, 0.0014934271495599736, 0.0007964944797653192, 0.000829681749755542, 0.0021903598193546286, 0.001659363499511084, 0.0051440268484843395, 0.0009292435597262063, 0.007500323017790093, 0.0017921125794719678, 0.0003318726999022154, 0.002854105219159063, 0.0038101657647236493, 0.0017921125794719678, 0.0010951799096773143, 0.000995618099706649, 6.637453998044318e-05, -0.008947420013668399, -0.009220717660357418, 0.003184362009677236, 0.004268510613819251, -0.001618843509675288, -0.0025926790584643216, -0.0001011777193547055, -1.2647214919338188e-05, 0.0, 0.0, 0.0, 0.0, 0.0, -0.003212392589511894, -0.003225039804431233, -0.003212392589511894, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0010117771935470564, 0.0, -0.0010117771935470564, 0.0, -2.5294429838676377e-05, 0.0, -0.0006323607459669072, 0.0, 0.0, 0.0, -6.323607459669102e-05, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.2647214919338188e-05, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.000809421754837644, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.002251204255642202, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0031209719791569454, 0.000957523651598372, -0.016501617990196837, -0.05265344545912275, 0.08371942925479213, -0.011146501537132886, 0.04591026392692636, 0.005588983084696736, 0.008564258105800453, -0.013987177159829533, -0.024296188519173187, -0.0475829297974543, 0.045913223865869976, 0.0034672059734147252, -0.008828248388472477, 0.0007285876700577168, 0.02346873419574941, 0.009213215079724264, 0.021836431606435655, -0.02947469264042508, 0.032461302119281985, -0.012963395408849207, 0.004059441532582953, -0.0999755819749518, -0.029016159085384116, -0.017174201533427236, -0.0056712971024707615, -0.019396768699154295, 0.048498910928904855, 0.012878538436698015, 0.001594283489671337, 0.06401778579259756, 0.062401604025315555, 0.002607161789394095, -0.005500731233724788, -0.008980393018838498, 0.038674654277696514, 0.011029725676511436, 0.02693585086770554, 0.0383493541333282, 0.03661644483543271, 0.022051162023304545, 0.03648518986684571, 0.034259954127771816, 0.06356772083844915, 0.01849480201108343, 0.036675432414875725, 0.063852676653956, 0.041482645772586674, 0.01692832233594764, 0.0347739703837822, 0.04426182965428677, 0.05635469605056803, -5.0469129889412066e-05, -0.022148517793867634, 0.027488874908332794, 0.03541907388022574, -0.05141793156346897, -0.0002908766071339359, 0.031493481515119125, 0.027099348222878985, 0.011290208369300012, 0.011940599039907051, 0.019787923831624164, 0.0195921550812431, -0.018139680700078566, 0.013793259549414086, 0.02015162163363992, 0.014483835606813553, 0.00494825880971431, 0.003541167476060121, 0.014106233083740757, 0.020840233763690888, 0.00334928720103745, 0.004803721487662612, 0.012678614202347794, 0.014266336101975405, 0.001725738039491524, 0.005309963198435446, 0.007367573937829204, 0.006438330378102991, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.00013911936411271984, 0.0, 0.0, 0.0, 0.0, -0.0030732732253991764, -0.0027823872822544103, -0.0001011777193547055, -1.2647214919338188e-05, -0.001618843509675288, -0.0025926790584643216, -0.0001011777193547055, -1.2647214919338188e-05, 0.0, 0.0, 0.0, 0.0, 0.0, -0.003212392589511894, -0.003225039804431233, -0.003212392589511894, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0010117771935470564, 0.0, -0.0010117771935470564, 0.0, -2.5294429838676377e-05, 0.0, -0.0006323607459669072, 0.0, 0.0, 0.0, -6.323607459669102e-05, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.2647214919338188e-05, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.000809421754837644, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.002251204255642202, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.002677748678085701, -0.013077312698862914, -0.042565637097037375, 0.06223149455482167, 0.0010775423837909284, -0.004924911583769626, 0.010051394394643766, 0.01123198124437785, -0.019284679791636103, -0.011125914606252292, -0.008104847785653407, -0.014746729214704907, 0.02460703851178334, -0.003343853943676812, -0.010145843468138249, -0.011044851351057636, -0.010468253043759108, -0.02995958032880149, 0.01883669939518778, -0.04047590284423728, 0.02475700863986741, -0.016959387224866652, -0.03781660429756024, 0.03416374285656071, -0.03424059916543965, -0.009095089619577525, 0.0025988103452210197, -0.05131153513473723, 0.023564947298862018, -0.001896346356925324, 0.0521725342175431, 0.019271816398045854, 0.0077309161784421924, 0.009768595210165572, 0.011074765270498863, 0.02066669105648988, -0.01729644873077413, 0.028227406419297902, 0.043428835463683375, 0.06608949680875617, 0.0838161745784189, 0.021129151850179644, 0.04954158859516743, 0.04663308144930164, 0.03878902264817129, 0.020837220473236485, 0.04495770500633601, 0.05638542198913169, 0.02804112581832966, 0.01240772462730036, 0.04251332183168743, 0.02071883727846414, 0.045321334751561256, -0.0013512250674431341, -0.03982531741829564, 0.023175606744714645, 0.03208758476720723, -0.03391952311554017, 0.007000214097871154, 0.013983144555729014, 0.02544559324532292, 0.006273041003666743, 0.011509799473087773, 0.005488588978333447, 0.022845654677383892, -0.011866573710736676, -0.0021588249921859677, 0.006335827565679446, 0.010644636423078458, 0.004936702485978054, 0.004121779119186826, 0.009699189575550271, 0.006708988675970276, 0.004068391478109545, 0.005599661271117884, 0.00431997483685947, 0.00231410007738552, 0.0021843164424145056, 0.004759853740186839, 0.0070093736584942975, 0.0042382259330430725, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.00013911936411271984, 0.0, 0.0, 0.0, 0.0, -0.0030732732253991764, -0.0027823872822544103, -0.0001011777193547055, -1.2647214919338188e-05, -0.001618843509675288, -0.0025926790584643216, -0.0001011777193547055, -1.2647214919338188e-05, 0.0, 0.0, 0.0, 0.0, 0.0, -0.003212392589511894, -0.003225039804431233, -0.003212392589511894, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0010117771935470564, 0.0, -0.0010117771935470564, 0.0, -2.5294429838676377e-05, 0.0, -0.0006323607459669072, 0.0, 0.0, 0.0, -6.323607459669102e-05, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.2647214919338188e-05, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.000809421754837644, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.002251204255642202, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.002250224494873715, -0.0004905426281080179, 0.05476782662845152, -0.0012653619148686925, 0.06332866200369476, 0.0012645879377174364, -0.001133484448736975, -0.03235119371682437, 0.08728472422967208, -0.006167602563775889, 0.025377580075552648, -0.005496526359868207, -0.06951053683009109, -0.012525470063448868, 0.002349330914704152, -0.030231197366314445, -0.002813372900752939, 0.0036097311160459716, -0.05476521536234015, 0.023037280347826858, -0.017747829909225472, 0.005082828112043069, 0.010521897516893615, 0.050546514978420956, -0.04498818521498604, -0.014285741267027516, -0.02087687066965845, 0.022128825369566563, -0.014939830713493146, -0.009700812561672472, -0.016762535005854156, 0.00652613379388743, 0.06499458801444759, 0.002420158365390909, 0.05668456248378799, 0.007182727968488706, 0.002589198221745477, 0.017161625477423476, 0.029680727468987735, 0.06161269978721562, 0.023613611283365178, 0.015935904153498222, 0.04583674734990824, 0.04763538306335782, 0.05543905859604316, 0.015312422028574501, 0.025346507844008666, 0.02414858901345228, 0.012391613221748577, 0.016339379076547485, 0.024781134034477976, 0.04180810026270893, 0.0422174028861355, 0.0022702515514216506, -0.020294585186842014, 0.04063467193171522, 0.027900969267777007, -0.025138410537558817, -0.007281457718142753, 0.012710224961270729, 0.017286183540850705, 0.004513148222858528, 0.01007771739277035, 0.004282475405478769, 0.006290151516850085, -0.007200805944676691, -0.0021355511267813084, 0.009315198645517879, 0.00620647695879315, 0.0, -0.00024029708346742518, 0.0, 0.0, 0.0, -1.2647214919338188e-05, 0.0, -1.2647214919338188e-05, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.00013911936411271984, 0.0, 0.0, 0.0, 0.0, -0.0030732732253991764, -0.0027823872822544103, -0.0001011777193547055, -1.2647214919338188e-05, -0.001618843509675288, -0.0025926790584643216, -0.0001011777193547055, -1.2647214919338188e-05, 0.0, 0.0, 0.0, 0.0, 0.0, -0.003212392589511894, -0.003225039804431233, -0.003212392589511894, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0010117771935470564, 0.0, -0.0010117771935470564, 0.0, -2.5294429838676377e-05, 0.0, -0.0006323607459669072, 0.0, 0.0, 0.0, -6.323607459669102e-05, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.2647214919338188e-05, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.000809421754837644, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.002251204255642202, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
let b = -0.003225039804431229;

let returnInt = (element) => {
    return parseInt(element, 16);
};

let sigmoid = (z) => {
    return 1 / (1 + Math.exp(-z));
};

let getFullNum = (num) => {
    //处理非数字
    if (isNaN(num)) {
        return num
    }
    //处理不需要转换的数字
    var str = '' + num;
    if (!/e/i.test(str)) {
        return num;
    }
    return (num).toFixed(18).replace(/\.?0+$/, "");
};

let matchingFeature = (templetArray, realData) => {
    console.log('matchingFeature function');
    for (let i = 0; i < templetArray.length; i++) {
        // 将此次识别到的指纹特征值与每一个模板都组成一次analyseData
        let analyseData = `${templetArray[i]} ${realData}`;
        // 将analyseData通过' '由字符串分割成数组
        let analyseArray = analyseData.split(' ');
        // 将analyseArray中字符转换成可计算数字
        analyseArray = analyseArray.map(returnInt);
        // 通过logistic回归(z=wx+b)算出z
        let z = 0;
        // 将此次组成的analyseData与之前训练得到的数据进行计算
        console.log(`w.length = ${w.length}`);
        console.log(`analyseArray[0].type = ${typeof (analyseArray[0])}`);
        for (let j = 0; j < 772; j++) {
            z += w[j] * analyseArray[j];
        }
        z += b;
        console.log(`z = ${z}`);
        let PR = getFullNum(sigmoid(z));
        console.log(`The matching rate of realData and ${i}th data is ${PR}`);
    }
};

module.exports = {
    matchingFeature
};